<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Webpage Title -->
        <title>Habits</title>

        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- favicon -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='diary.png') }}" />

        <!-- JS -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"
        ></script>

        <!-- FullCalendar-Moment -->
        <script class="cssdesk" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.0/moment.min.js" type="text/javascript"></script>

        <!-- Íµ¨Í∏ÄÌè∞Ìä∏ -->
        <link href="https://fonts.googleapis.com/css?family=Stylish&display=swap" rel="stylesheet" />

        <!-- FontAwesome -->
        <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
            integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
            crossorigin="anonymous"
        />

        <!-- CSS -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/daygrid.css') }}?1=1" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/fullcalendar.css') }}?1=4" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}?1=18" />
        <link rel="stylesheet" href="{{ url_for('static', filename='css/habit.css') }}?1=9" />

        <!-- JS -->
        <script src="{{ url_for('static', filename='js/vendor/fullcalendar.js') }}"></script>
        <script src="{{ url_for('static', filename='js/vendor/daygrid.js') }}"></script>
        <script src="{{ url_for('static', filename='js/vendor/interaction.js') }}"></script>
        <script src="{{ url_for('static', filename='js/vendor/chart.js') }}"></script>
        <script src="{{ url_for('static', filename='js/calendar.js') }}?1=41"></script>
        <script src="{{ url_for('static', filename='js/modal.js') }}?1=8"></script>
    </head>

    <body>
        <div class="header">
            <h1>{{ username }}ÎãòÏùò ÏäµÍ¥ÄÎã¨Î†•&nbsp;<i class="fas fa-book-open"></i></h1>
        </div>

        <!-- ÏäµÍ¥ÄÎ™©Î°ù -->
        <div class="btn__container">
            <button onClick="goHome()" type="button" class="default-btn">Home</button>
            <button type="button" class="default-btn goToday">Today</button>
        </div>

        <div id="external-events">
            <p><i class="far fa-list-alt"></i>&nbsp;<strong>ÎÇòÏùò ÏäµÍ¥ÄÎ™©Î°ù</strong></p>
            {% for habit in habits %}
            <div class="fc-event {{habit.color}}">{{ habit.habit }}</div>
            {% endfor %}
            <button onClick="openAddHabits()" type="button" class="default-btn">ÏäµÍ¥ÄÏ∂îÍ∞Ä</button>
            <button onClick="openChartModal()" type="button" class="default-btn">ÌÜµÍ≥Ñ</button>
        </div>

        <!-- ÏäµÍ¥Ä ÏàòÏ†ï/ÏÇ≠Ï†ú -->
        <div id="multiModal" class="modal">
            <div class="content multiModal__content">
                <div class="row">
                    <h2>ÏäµÍ¥ÄÏàòÏ†ï</h2>
                </div>
                <div class="row">
                    <div class="form-control">
                        <label class="label" for="editName">ÏäµÍ¥ÄÏù¥Î¶Ñ</label>
                        <input type="text" id="editName" />
                        <p>Error Message</p>
                    </div>
                    <label class="label" for="color">ÏÉâÏÉÅ</label>
                    <select name="color" id="select-color">
                        <option value="deep-blue">ÎÇ®ÏÉâ</option>
                        <option value="green">Ï¥àÎ°ù</option>
                        <option value="orange">Ï£ºÌô©</option>
                        <option value="yellow">ÎÖ∏Îûë</option>
                        <option value="beige">Î≤†Ïù¥ÏßÄ</option>
                        <option value="pink">ÌïëÏø†</option>
                        <option value="burgendy">Î≤ÑÍ±¥Îîî</option>
                        <option value="grey">ÌöåÏÉâ</option>
                    </select>
                </div>
                <div class="row">
                    <button type="button" class="default-btn" id="close-btn">Îã´Í∏∞</button>
                    <button type="button" class="delete-btn" id="delete-btn">ÏÇ≠Ï†ú</button>
                    <button type="button" class="save-btn" id="save-btn">Ï†ÄÏû•</button>
                </div>
            </div>
        </div>

        <!-- ÏäµÍ¥ÄÏ∂îÍ∞Ä -->
        <div id="addHabits" class="modal">
            <div class="content addHabits__content">
                <div class="row">
                    <h2>ÏäµÍ¥ÄÎì±Î°ù</h2>
                </div>
                <div class="row">
                    <div class="form-control">
                        <label class="label" for="habit">ÏäµÍ¥ÄÏù¥Î¶Ñ</label>
                        <input type="text" id="habit" name="habit" />
                        <p>Error Message</p>
                    </div>
                    <label class="label" for="color">ÏÉâÏÉÅ</label>
                    <select name="color" id="add__select-color">
                        <option value="deep-blue">ÎÇ®ÏÉâ</option>
                        <option value="green">Ï¥àÎ°ù</option>
                        <option value="orange">Ï£ºÌô©</option>
                        <option value="yellow">ÎÖ∏Îûë</option>
                        <option value="beige">Î≤†Ïù¥ÏßÄ</option>
                        <option value="pink">ÌïëÏø†</option>
                        <option value="burgendy">Î≤ÑÍ±¥Îîî</option>
                        <option value="grey">ÌöåÏÉâ</option>
                    </select>
                </div>
                <div class="row">
                    <button type="button" class="default-btn" onClick="closeAddHabits()">Îã´Í∏∞</button>
                    <button type="button" class="save-btn" onClick="addHabits()">Îì±Î°ù</button>
                </div>
            </div>
        </div>

        <!-- Îã¨Î†• -->
        <div id="calendar"></div>

        <!-- ÌÜµÍ≥ÑÏ∞®Ìä∏ -->
        <div id="chart__container" class="modal">
            <div class="content chart__content">
                <div class="box">
                    <div class="chart__column">
                        <span>Ïõî ÏÑ†ÌÉù :</span>
                        <select name="selectMonth" id="selectMonth">
                            <option value="01">JAN</option>
                            <option value="02">FEB</option>
                            <option value="03">MAR</option>
                            <option value="04">APR</option>
                            <option value="05">MAY</option>
                            <option value="06">JUN</option>
                            <option value="07">JUL</option>
                            <option value="08">AUG</option>
                            <option value="09">SEP</option>
                            <option value="10">OCT</option>
                            <option value="11">NOV</option>
                            <option value="12">DEC</option>
                        </select>
                        <button type="button" onClick="openChart()" class="default-btn">Î≥¥Í∏∞</button>
                    </div>
                    <div class="chart__column">
                        <button type="button" class="default-btn" onClick="closeChart()">Îã´Í∏∞</button>
                    </div>
                </div>
                <div class="box">
                    <div id="graph" class="modal">
                        <h2>ÌïúÎã¨Ïóê Ïù¥ÎßåÌÅº ÌñàÎÑ§Ïöî üòÑ</h2>
                        <div>
                            <canvas id="myChart" height="500" width="1000"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>
        $("#external-events")
            .find("div")
            .click((e) => {
                const modal = $("#multiModal");
                const content = $("#multiModal .multiModal__content");
                const marginLeft = content.outerWidth() / 2;
                const marginTop = content.outerHeight() / 2;

                if (modal.css("display") === "none") {
                    modal.fadeIn(400);
                    content.css({
                        "margin-top": -marginTop,
                        "margin-left": -marginLeft,
                    });
                }
                bgLayerOpen();

                // Ï≤òÏùå ÏÑ§Ï†ïÌïú habit ÏÉâÍπî select boxÏóê Îú®Í≤å ÏÑ§Ï†ï
                const colorName = e.target.classList[1];

                if (e.target.classList[1] === "deep-blue") {
                    $("#select-color option:eq(0)").prop("selected", true);
                }
                if (e.target.classList[1] === "green") {
                    $("#select-color option:eq(1)").prop("selected", true);
                }
                if (e.target.classList[1] === "orange") {
                    $("#select-color option:eq(2)").prop("selected", true);
                }
                if (e.target.classList[1] === "yellow") {
                    $("#select-color option:eq(3)").prop("selected", true);
                }
                if (e.target.classList[1] === "beige") {
                    $("#select-color option:eq(4)").prop("selected", true);
                }
                if (e.target.classList[1] === "pink") {
                    $("#select-color option:eq(5)").prop("selected", true);
                }
                if (e.target.classList[1] === "burgendy") {
                    $("#select-color option:eq(6)").prop("selected", true);
                }
                if (e.target.classList[1] === "grey") {
                    $("#select-color option:eq(7)").prop("selected", true);
                }

                const currentEmail = location.search.split("=")[1];

                // Î™®Îã¨Ï∞ΩÏóê ÏõêÎûò ÏäµÍ¥Ä Ïù¥Î¶Ñ Î≥¥Ïù¥Í∏∞
                const targetName = e.target.innerHTML;
                $("#editName").val(targetName);

                // ÏäµÍ¥Ä ÏÇ≠Ï†ú
                $("#delete-btn").click((e) => {
                    $.ajax({
                        type: "POST",
                        url: "/habits-delete2",
                        data: {
                            email: currentEmail,
                            title: targetName,
                        },
                        success: () => {
                            $("#multiModal").fadeOut(400);
                            bgLayerClear();
                            window.location.reload();
                        },
                    });
                });

                // ÏäµÍ¥Ä ÏàòÏ†ïÏÇ¨Ìï≠ Î≥ÄÍ≤Ω
                $("#save-btn").click(() => {
                    const nameInput = $("#editName");
                    const newName = $("#editName").val();
                    const newColorName = $("#select-color option:checked").val();

                    if (newColorName === "deep-blue") color = "#4d638c";
                    else if (newColorName === "green") color = "#83b799";
                    else if (newColorName === "orange") color = "#ffa94d";
                    else if (newColorName === "yellow") color = "#e2cd6d";
                    else if (newColorName === "beige") color = "#c3b28f";
                    else if (newColorName === "pink") color = "#e86f68";
                    else if (newColorName === "burgendy") color = "#881d1d";
                    else if (newColorName === "grey") color = "#495057";

                    if (colorName !== newColorName) {
                        $(e.target).attr(`${colorName}`, `${newColorName}`);
                        $(".fc-event").attr(`${colorName}`, `${newColorName}`);
                    }

                    if (newName.length < 1) {
                        showError(nameInput, `1Í∏ÄÏûê Ïù¥ÏÉÅÏù¥ ÎêòÏñ¥ÏïºÌï©ÎãàÎã§`);
                    } else if (newName.length > 8) {
                        showError(nameInput, ` 8Í∏ÄÏûê Ïù¥ÌïòÎ°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî`);
                    } else {
                        $.ajax({
                            type: "POST",
                            url: "/habits-edit",
                            data: {
                                email: currentEmail,
                                title: targetName,
                                newTitle: newName,
                                colorName: colorName,
                                newColorName: newColorName,
                                color: color,
                            },
                            dataType: "json",
                            success: function (response) {
                                if (response["result"] === "success") {
                                    window.location.reload();
                                } else {
                                    alert("error");
                                }
                            },
                        });
                    }
                });

                $("#close-btn").click(() => {
                    $("#multiModal").fadeOut(400);
                    bgLayerClear();
                });
            });
    </script>
</html>
